@echo off
set CONSOLE=atari2600

IF EXIST pixelcade.ini (
  for /f "tokens=1,2 delims==" %%a in (pixelcade.ini) do ( 
  	if %%a==port set port_=%%b
  	if %%a==ledResolution set ledResolution_=%%b
  	if %%a==userMessageTitle set userMessageTitle_=%%b
  	if %%a==userMessageDefault set userMessageDefault_=%%b
  	if %%a==userMessageGenericPlatform set userMessageGenericPlatform_=%%b
  	if %%a==userMessageGameSpecific set userMessageGameSpecific_=%%b
  	if %%a==userMessageNoChange set userMessageNoChange_=%%b
  	if %%a==MAMEDEFAULT set MAMEDEFAULT_=%%b
  )
) ELSE (
  echo pixelcade.ini is missing, please add this file
  EXIT /B
)

echo %port_%
echo %ledResolution_%
echo %userMessageTitle_%
echo %userMessageDefault_%
echo %userMessageGenericPlatform_%
echo %userMessageGameSpecific_%
echo %userMessageNoChange_%
echo %MAMEDEFAULT_%

set ATARI2600DEFAULT=default-atari2600.gif
REM *******************************************************************************************

set USERMESSAGE=""

set PLATFORM=%1
set GAMENAME=%~2
REM set GAMENAME=g
SET WORKINGPATH=%~dp0
echo Working Path: %WORKINGPATH%

rem echo gamename is "%GAMENAME%"

rem For %%A in ("%GAMENAME%") do (
rem echo last pause
rem pause
rem     echo file name only: %%~nA
rem    set "GAMENAME=%%~nA"
rem )

ECHO gamename is before: %GAMENAME%
rem echo Selected Game NAME: %GAMENAME%
rem echo Selected Platform from Script: %PLATFORM%\%GAMENAME%.gif
rem echo Selected Console Hard Code: %WORKINGPATH%%CONSOLE%\%GAMENAME%.gif
rem set "GAMENAME=%WORKINGPATH%%CONSOLE%\%GAMENAME%.gif"
rem set "GAMENAME=%WORKINGPATH%%CONSOLE%\3-D Tic-Tac-Toe (1980) (Atari).gif"

rem set "GAMENAME=%WORKINGPATH%%CONSOLE%\3-D Tic-Tac-Toe ^(1980^) ^(Atari^).gif"
set "GAMENAME=%WORKINGPATH%%CONSOLE%\3-D Tic-Tac-Toe (1980) (Atari).gif"
set "GAMENAMERAW=%WORKINGPATH%%CONSOLE%\3-D Tic-Tac-Toe (1980) (Atari).gif"

rem For %%i In (%GAMENAME:)=^)%) Do Echo=%%i
rem setlocal ENABLEDELAYEDEXPANSION
rem For %%i In (%GAMENAME:)=^)%) Do (
rem	Echo=%%i
rem )	

set str=%GAMENAME%
set str=!str:^(=^^^(!
set str=!str:^)=^^^)!
echo with carrots !str!
echo with carrots2 %str%
set GAMENAME=!str!
echo !GAMENAME!

IF EXIST "!%GAMENAME%!" (
    set USERMESSAGE=Writing LED Marquee for %GAMENAME%...
    echo went here match...
) ELSE (
   set USERMESSAGE=Writing Generic LED Marquee for the %CONSOLE% emulator...
   echo went here no match...
   set GAMENAME=%ATARI2600DEFAULT% 
)
pause

rem setlocal ENABLEDELAYEDEXPANSION
rem for /f "tokens=1* delims=" %%a in "%GAMENAME%" do (
rem    set par1=%%a
rem   set par1=!par1:^(=^^^(!
rem   set par1=!par1:^)=^^^)!
rem   echo !par1!
rem )

   
echo *** PIXEL LED MARQUEE ***
echo %USERMESSAGE%

echo pixelc.exe --port=%port_% --gif="%GAMENAMERAW%" --%ledResolution_% --write --silent
pixelc.exe --port=%port_% --gif="%GAMENAMERAW%" --%ledResolution_% --write 

REM possible to do, the java code coud run without a port the first time and then write the detected port to a .txt file. if port not specified here, could read this file as a backup
pause
